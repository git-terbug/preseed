#!/bin/bash -e 
#
#Instala ODK Aggregate después de ejecutar el asistente

echo "$(tput bold)Instalando ODK Aggregate$(tput sgr0)" | tee $PS_LOG/aggregate-ps
echo 'creando base de datos' | tee -a $PS_LOG/aggregate-ps
#mysql
#mysql --user root < ~/ODK\ Aggregate/create_db_and_user.sql
#postgres
sudo -u postgres psql < $DEF_PATH/ODK\ Aggregate/create_db_and_user.sql 
echo 'base de datos creada' | tee -a $PS_LOG/aggregate-ps

cp "$DEF_PATH/ODK Aggregate/ODKAggregate.war" $TOMCAT_APPS
 
echo -e '\nReiniciando procesos' | tee -a $PS_LOG/aggregate-ps
#mysql
#systemctl restart mysql
#postgresql
(systemctl restart postgresql && echo 'reinicio exitoso Postgresql' || echo 'falló el reinicio Postgresql') | tee -a $PS_LOG/aggregate-ps
(systemctl restart tomcat8 && echo 'reinicio exitoso Tomcat' || echo 'falló el reinicio Tomcat') | tee -a $PS_LOG/aggregate-ps
exit 0
